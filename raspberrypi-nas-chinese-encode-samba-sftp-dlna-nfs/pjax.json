{"title":"RaspberryPi搭建NAS之中文兼容性检测","url":"/raspberrypi-nas-chinese-encode-samba-sftp-dlna-nfs/","content":"<blockquote>\n<p>浙江大学嵌入式系统课程</p>\n<p>在RPi上搭建NAS的过程详见《<a href=\"http://www.nilennoct.com/raspberrypi-nas-samba-sftp/\" target=\"_blank\" rel=\"external\">在RaspberryPi上搭建NAS</a>》</p>\n</blockquote>\n<p>NAS已经搭建好了，接下来我们要测试一下各种方式对中文路径名、文件名的兼容情况。</p>\n<p><strong>Samba</strong></p>\n<p>如下图所示，是Win8下访问通过Samba方式访问RPi的效果。我们可以发现不需要多余的设置，中文已经很完美的显示了。</p>\n<p><img src=\"http://img.nilennoct.com/wp-content/uploads/2013/03/Task_09_01.png\" alt=\"Task_09_01\"><br><a id=\"more\"></a></p>\n<p>同样的，在iPad上可以正常显示。</p>\n<p><img src=\"http://img.nilennoct.com/wp-content/uploads/2013/03/2013-03-07-10.32.53.png\" alt=\"2013-03-07 10.32.53\"></p>\n<hr>\n<p><strong>SFTP</strong></p>\n<p>打开WinSCP，使用默认设置连接RPi，会发现中文全都变成了乱码，如下图。</p>\n<p><img src=\"http://img.nilennoct.com/wp-content/uploads/2013/03/Task_09_02.png\" alt=\"Task_09_02\"></p>\n<p>解决的方法很简单，打开WinSCP的登录界面，若是已经存储了会话，先读取。点击左侧的“环境”，将右侧的“文件名UTF-8编码”改为开启，如下图所示。</p>\n<p><img src=\"http://img.nilennoct.com/wp-content/uploads/2013/03/Task_09_03.png\" alt=\"Task_09_03\"></p>\n<p>重新连接，可以看到这下中文正常显示了（若是使用其他客户端，请寻找类似选项做类似的修改）。</p>\n<p><img src=\"http://img.nilennoct.com/wp-content/uploads/2013/03/Task_09_04.png\" alt=\"Task_09_04\"></p>\n<hr>\n<p><strong>DLNA</strong></p>\n<p>在RPi上启动minidlna，在iPad上打开AcePlayer，选择Media Servers，会自动搜索局域网内的DLNA服务器。如下图所示。</p>\n<p><img src=\"http://img.nilennoct.com/wp-content/uploads/2013/03/2013-03-07-11.33.35.png\" alt=\"2013-03-07 11.33.35\"></p>\n<p>选择raspberry:minidlna，即可查看各种媒体文件，如下图。可以看到中文也正常显示了。</p>\n<p><img src=\"http://img.nilennoct.com/wp-content/uploads/2013/03/2013-03-07-11.08.22.png\" alt=\"2013-03-07 11.08.22\"></p>\n<hr>\n<p><strong>NFS（之前的文章未提到该方法，在此作补充）</strong></p>\n<p>首先安装NFS</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">sudo</span> apt-get install nfs-kernel-server</div></pre></td></tr></table></figure>\n\n<p>编辑/etc/exports文件，在最后添加以下内容。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">/media/NAS *(rw,<span class=\"keyword\">sync</span>,no_root_squash)</div></pre></td></tr></table></figure>\n\n<p>启动rpcbind。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">sudo</span> update-rc.d rpcbind enable && update-rc.d nfs-common enable</div><div class=\"line\"><span class=\"built_in\">sudo</span> service rpcbind start</div></pre></td></tr></table></figure>\n\n<p>重启nfs-kernel-server</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">sudo</span> service nfs-kernel-server restart</div></pre></td></tr></table></figure>\n\n<p><img src=\"http://img.nilennoct.com/wp-content/uploads/2013/03/Task_09_05.png\" alt=\"Task_09_05\"></p>\n<p>进入ubuntu，打开终端，输入以下命令。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">cd</span> ~</div><div class=\"line\">mkdir nfs</div><div class=\"line\"><span class=\"built_in\">sudo</span> mount <span class=\"number\">192.168</span>.<span class=\"number\">0.4</span>:/media/NAS /home/neo/nfs</div></pre></td></tr></table></figure>\n\n<p><img src=\"http://img.nilennoct.com/wp-content/uploads/2013/03/Task_09_06.png\" alt=\"Task_09_06\"></p>\n<p>可以看到通过NFS方式访问RPi也能正常的显示中文。</p>\n<p>若出现如下错误提示</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">mount: wrong fs type, bad <span class=\"keyword\">option</span>, bad superblock <span class=\"keyword\">on</span> fs2:/data3,</div><div class=\"line\">missing codepage <span class=\"keyword\">or</span> helper program, <span class=\"keyword\">or</span> other <span class=\"keyword\">error</span></div><div class=\"line\">(<span class=\"keyword\">for</span> several filesystems (e.g. nfs, cifs) you might</div><div class=\"line\">need a /sbin/mount. helper program)</div><div class=\"line\"><span class=\"keyword\">In</span> some cases useful info <span class=\"keyword\">is</span> found <span class=\"keyword\">in</span> syslog - <span class=\"keyword\">try</span></div><div class=\"line\">dmesg | tail <span class=\"keyword\">or</span> so</div></pre></td></tr></table></figure>\n\n<p>请执行如下命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">sudo</span> apt-get install nfs-common</div></pre></td></tr></table></figure>\n\n","layout":"post"}